"use strict";(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[4682],{7632:function(e,t,a){a.d(t,{AuthProvider:function(){return l},E:function(){return h}});var s=a(7437),r=a(2265),n=a(9775);class i{constructor(){this.tokenKey="auth_token",this.userKey="auth_user",this.baseUrl="https://api.seniindah.co.id"}async login(e){try{let t=await (0,n.sg)("/v1.0/auth/login",e);if(t.success&&"object"==typeof t.data&&t.data.token)return this.setToken(t.data.token),this.setUser(t.data.user),this.scheduleTokenRefresh(t.data.expires_in||3600),{success:!0,user:t.data.user};return{success:!1,message:"string"==typeof t.data?t.data:"Login gagal"}}catch(e){if(e instanceof n.MS)return{success:!1,message:e.message||"Terjadi kesalahan saat login"};return{success:!1,message:"Terjadi kesalahan koneksi"}}}async logout(){try{this.getToken()&&await (0,n.sg)("/v1.0/auth/logout",{})}catch(e){}finally{this.clearAuth()}}async verifyToken(){if(!this.getToken())return!1;try{return(await (0,n.sg)("/v1.0/auth/verify",{})).success}catch(e){return e instanceof n.MS&&(401===e.status||403===e.status)&&this.clearAuth(),!1}}async refreshToken(){if(!this.getToken())return!1;try{let e=await (0,n.sg)("/v1.0/auth/refresh",{});if(e.success&&"object"==typeof e.data&&e.data.token)return this.setToken(e.data.token),this.scheduleTokenRefresh(e.data.expires_in||3600),!0;return!1}catch(e){return e instanceof n.MS&&(401===e.status||403===e.status)&&this.clearAuth(),!1}}setToken(e){localStorage.setItem(this.tokenKey,e)}getToken(){return localStorage.getItem(this.tokenKey)}setUser(e){localStorage.setItem(this.userKey,JSON.stringify(e))}getUser(){{let e=localStorage.getItem(this.userKey);return e?JSON.parse(e):null}}isAuthenticated(){return!!this.getToken()}clearAuth(){localStorage.removeItem(this.tokenKey),localStorage.removeItem(this.userKey)}scheduleTokenRefresh(e){setTimeout(async()=>{await this.refreshToken()||(this.clearAuth(),window.location.href="/login")},(e-300)*1e3)}getAuthHeader(){let e=this.getToken();return e?{Authorization:`Bearer ${e}`}:{}}async changePassword(e,t){try{let a=await (0,n.sg)("/v1.0/auth/change-password",{currentPassword:e,newPassword:t});if(a.success)return{success:!0,message:"Password berhasil diubah"};return{success:!1,message:"string"==typeof a.data?a.data:"Gagal mengubah password"}}catch(e){if(e instanceof n.MS)return{success:!1,message:e.message||"Terjadi kesalahan saat mengubah password"};return{success:!1,message:"Terjadi kesalahan koneksi"}}}}let o=new i,c=()=>{let[e,t]=(0,r.useState)(null),[a,s]=(0,r.useState)(!0),[n,i]=(0,r.useState)(!1);return(0,r.useEffect)(()=>{(async()=>{s(!0),o.getToken()&&(await o.verifyToken()?(t(o.getUser()),i(!0)):o.clearAuth()),s(!1)})()},[]),{user:e,loading:a,isAuthenticated:n,login:async(e,a)=>{let s=await o.login({email:e,password:a});return s.success&&s.user&&(t(s.user),i(!0)),s},logout:async()=>{await o.logout(),t(null),i(!1)}}},u=(0,r.createContext)(void 0),l=e=>{let{children:t}=e,a=c();return(0,s.jsx)(u.Provider,{value:a,children:t})},h=()=>{let e=(0,r.useContext)(u);if(void 0===e)throw Error("useAuthContext must be used within an AuthProvider");return e}},4682:function(e,t,a){var s=a(7437),r=a(2265),n=a(6463),i=a(7632);t.Z=e=>{let{children:t,requiredRole:a,redirectTo:o="/login"}=e,{isAuthenticated:c,user:u,loading:l}=(0,i.E)(),h=(0,n.useRouter)(),d=e=>({super_admin:3,admin:2,moderator:1,user:0})[e]||0,g=(e,t)=>d(e)>=d(t);return((0,r.useEffect)(()=>{if(!l){if(!c){h.push(o);return}if(a&&u?.role&&!g(u.role,a)){h.push("/unauthorized");return}}},[c,u,l,a,o,h]),l)?(0,s.jsx)("div",{className:"min-h-screen flex items-center justify-center",children:(0,s.jsxs)("div",{className:"flex items-center space-x-4",children:[(0,s.jsx)("div",{className:"animate-spin rounded-full h-8 w-8 border-b-2 border-blue-600"}),(0,s.jsxs)("div",{children:[(0,s.jsx)("p",{className:"text-gray-600 font-medium",children:"Loading..."}),(0,s.jsx)("p",{className:"text-xs text-gray-400",children:"Checking authentication & permissions..."})]})]})}):!c||a&&u?.role&&!g(u.role,a)?null:(0,s.jsx)(s.Fragment,{children:t})}},9775:function(e,t,a){a.d(t,{MS:function(){return d},U8:function(){return w},sg:function(){return p}});let s=()=>crypto.getRandomValues(new Uint8Array(12)),r=async(e,t)=>{let a=s(),r=new TextEncoder().encode(e);return{encryptedData:btoa(String.fromCharCode(...new Uint8Array(await crypto.subtle.encrypt({name:"AES-GCM",iv:a},t,r)))),iv:btoa(String.fromCharCode(...a))}},n=async(e,t,a)=>{let s=Uint8Array.from(atob(e),e=>e.charCodeAt(0)),r=Uint8Array.from(atob(t),e=>e.charCodeAt(0)),n=await crypto.subtle.decrypt({name:"AES-GCM",iv:r},a,s);return new TextDecoder().decode(n)},i=new Uint8Array([43,126,21,22,40,174,210,166,171,247,21,136,9,207,79,60,43,126,21,22,40,174,210,166,171,247,21,136,9,207,79,60]),o=null,c=async()=>{o=await crypto.subtle.importKey("raw",i,{name:"AES-GCM",length:256},!1,["encrypt","decrypt"])},u=async()=>(o||await c(),o),l=async e=>{let t=await u(),a=JSON.stringify(e),s=await r(a,t);return{data:s.encryptedData,iv:s.iv}},h=async(e,t)=>{let a=await u();return JSON.parse(await n(e,t,a))};c();class d extends Error{constructor(e,t,a){super(e),this.name="ApiError",this.status=t,this.data=a}}let g=()=>localStorage.getItem("auth_token"),y=e=>{localStorage.setItem("session_value",e)},f=()=>localStorage.getItem("session_value"),m=async e=>{let{endpoint:t,method:a="POST",headers:s={},body:r,encrypted:n=!0,formData:i=!1}=e;try{let e=`https://api.seniindah.co.id${t}`,o={...s},c=g();c&&(o.Authorization=`Bearer ${c}`),n&&!i&&(o["Accept-Encryption"]="aes-gcm");let u=null;if(r){if(i)u=r;else if(n){let e=await l(r),t=f(),a={data:e.data,iv:e.iv};t&&(a.sv=t),u=btoa(JSON.stringify(a)),o["Content-Type"]="application/json"}else u=JSON.stringify(r),o["Content-Type"]="application/json"}let m=await fetch(e,{method:a,headers:o,body:u}),p=null;try{let e=m.headers.get("content-type");if(e&&e.includes("application/json")){let e=await m.text();if(e.trim())try{let t=JSON.parse(e);if(t.status&&t.detail){if("ERROR"===t.status){try{let e=atob(t.detail),a=JSON.parse(e);p=a.data&&a.iv?await h(a.data,a.iv):a}catch(e){p={message:t.detail}}throw new d(p.message||"Server returned error",m.status,p)}try{let e=atob(t.detail),a=JSON.parse(e);if(a.data&&a.iv)p=await h(a.data,a.iv),a.xy&&y(a.xy);else throw Error("Invalid encrypted object structure")}catch(e){throw new d("Failed to decrypt response",m.status,e)}}else p=t}catch(t){p=e}else p=null}else p=await m.text()}catch(e){throw new d(`Failed to read response: ${e.message}`,m.status)}if(!m.ok)throw new d(`HTTP ${m.status}: ${m.statusText}`,m.status,p);return p}catch(e){if(e instanceof d)throw e;if(e instanceof Error)throw new d(e.message,0,e);throw new d("Unknown error occurred",0,e)}},p=function(e,t,a){let s=!(arguments.length>3)||void 0===arguments[3]||arguments[3];return m({endpoint:e,method:"POST",body:t,headers:a,encrypted:s})},w=(e,t,a)=>m({endpoint:e,method:"POST",body:t,headers:a,encrypted:!1,formData:!0})}}]);